---
title: "Homework 5"
output: github_document
date: "2022-11-03"
---

```{r, include = FALSE}
library(tidyverse)
library(ggplot2)

set.seed(1)
```

## Problem 2
```{r}
homicide_df = read.csv("./data/homicide-data.csv")
```
The raw data contains `r nrow(homicide_df)` observations and `r ncol(homicide_df)` variables. The key variables are uid, reported date, victim last name, victim first name, victim race, victim age, victim sex, city, state, latitude, longitude, and disposition. The dataset contains information from `r homicide_df %>% distinct(state) %>% nrow()` distinct states.

```{r}
homicide_df = homicide_df %>% mutate(city_state = paste(city, state, sep = ", "))

homicide_summary = homicide_df %>% group_by(city_state) %>% summarize(total_homicide = n(), unsolved_homicides = sum(disposition == "Closed without arrest" | disposition == "Open/No arrest"))

head(homicide_summary, 5) %>% knitr::kable()
```

```{r}
baltimoreptest = prop.test(homicide_summary %>% filter(city_state == "Baltimore, MD") %>% pull(unsolved_homicides), homicide_summary %>% filter(city_state == "Baltimore, MD") %>% pull(total_homicide))

baltimoreptest = baltimoreptest %>% broom::tidy()
```

The estimated proportion is approximately `r round(baltimoreptest %>% select(estimate), 2)` and the 95% confidence interval is (`r round(baltimoreptest %>% select(conf.low, conf.high), 2)`).

```{r}
homicide_sum = homicide_summary %>% mutate(
    prop_test = map2(
        homicide_summary$unsolved_homicides,
        homicide_summary$total_homicide, prop.test), 
    results = map(prop_test, broom::tidy)
    )

homicide_sum = homicide_sum %>% unnest(results) %>% select(-c(prop_test, parameter, method, alternative))

ggplot(homicide_sum, aes(x = city_state, y = estimate)) + 
  geom_point() + geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
  labs(x = "City, State", y = "Proportion of Unsolved Homicides")
```


## Problem 3
```{r}
sim = function(n, mu = 0, sigma = 5) {
  
  sim_data = tibble(
    x = rnorm(n = n, mean = mu, sd = sigma),
  )
}

mu_0_df = 
  expand_grid(
    sample_size = 30,
    iter = 1:5000
  ) %>% 
  mutate(
    estimate_df = map(sample_size, sim)
  ) %>% group_by(iter) %>%
  mutate(
    mean = map_dbl(.x = estimate_df, ~mean(.x$x)),
    t_test = map(.x = estimate_df, ~t.test(.x$x)),
    results = map(t_test, broom::tidy)
    ) 

mu_0_df = mu_0_df %>% unnest(results) %>% dplyr::select(-c("estimate_df", "t_test", "parameter", "method", "alternative"))
```


